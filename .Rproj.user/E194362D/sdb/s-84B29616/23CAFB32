{
    "collab_server" : "",
    "contents" : "#' Function to create a babynames statistics database for Spanish names\n#'\n#' @return a babynames statistics database, listing for each name the most likely gender and year of birth\n#' @param verbose if TRUE generate verbose output\n#' @export\n#' @import httr\n#' @import dplyr\n#' @import rvest\n#' @import stringi\n#' @import readr\n\nSpanishNames<-function(verbose=T) {\n\n  dir.create(paste0(getwd(), \"/temp\"))\n  setwd(paste0(getwd(), \"/temp\"))\nlapply(seq(from=1920, to=2010, by=10), FUN=function(x) {\n  logmessage(x, verbose)\n  #MALES\n  males<-POST(\"http://www.ine.es/tnombres/formGeneralresult.do?vista=3\", body=list(cmb4=\"00\", cmb10=as.character(x), cmb7=\"1\", btnBuscar=\"btnBuscar\"))\n  males<-content(males) %>%\n    html_nodes(xpath=\"//table[@summary='resultados']\") %>%\n    html_table()\n\n  males<- select(males[[1]], Nombre, Total)\n  males$Total<-stri_replace_all_fixed(males$Total, \".\", \"\")\n  males$sex<-\"M\"\n  males$Nombre<-stri_trans_tolower(males$Nombre)\n  males$year=as.character(x)\n  colnames(males)<-c(\"name\", \"n\", \"sex\",\"year\")\n  write_csv(males, paste0(\"INE_\",x,\"_male.csv\"))\n\n  #Females\n  females<-POST(\"http://www.ine.es/tnombres/formGeneralresult.do?vista=3\", body=list(cmb4=\"00\", cmb10=as.character(x), cmb7=\"6\", btnBuscar=\"btnBuscar\"))\n  females<-content(females) %>%\n    html_nodes(xpath=\"//table[@summary='resultados']\") %>%\n    html_table()\n\n  females<- select(females[[1]], Nombre, Total)\n  females$Total<-stri_replace_all_fixed(females$Total, \".\", \"\")\n  females$sex<-\"F\"\n  females$Nombre<-stri_trans_tolower(females$Nombre)\n  females$year=as.character(x)\n  colnames(females)<-c(\"name\", \"n\", \"sex\",\"year\")\n  write_csv(females, paste0(\"INE_\",x,\"_female.csv\"))\n\n})\n\n\nspanish_baby_names<- lapply(list.files(getwd(), \".csv\"), FUN=function(x) {\n  readr::read_csv(x, col_types=cols(\n    name = col_character(),\n    n = col_integer(),\n    sex = col_character(),\n    year = col_integer()\n  ))}) %>%\n      bind_rows()\nspanish_baby_names$name<-sapply(spanish_baby_names$name, FUN=function(x) {\n  stri_split_fixed(x, \" \")[[1]][1]\n}) %>%\n  stri_trim()\nspanish_baby_names<-spanish_baby_names %>%\n filter(year!=1920) %>%\nfilter(year!=2010) %>%\n  ungroup() %>%\n group_by(name, year, sex) %>%\n  summarise(n=sum(as.numeric(n))) %>%\n ungroup()%>%\n   group_by(name) %>%\nmutate(prob=n/sum(as.numeric(n))) %>%\n  filter(prob==max(prob))\n\nunlink(paste0(getwd(), \"/temp\"), recursive=T)\nreturn(spanish_baby_names)\n}\n",
    "created" : 1505381041964.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1919854906",
    "id" : "23CAFB32",
    "lastKnownWriteTime" : 1505383319,
    "last_content_update" : 1505383319728,
    "path" : "~/Desktop/tweetCorp/R/SpanishNames.R",
    "project_path" : "R/SpanishNames.R",
    "properties" : {
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}